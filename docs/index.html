<!DOCTYPE html>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Active Learning Design</title>

<h1>Active Learning Design</h1>
<button class="expand">Add More Nodes!</button>

<script src="https://d3js.org/d3.v7.min.js"></script> 

<svg width ="800" height ="800"></svg>

<style>
  svg {
    border: 1px dashed black;
  }
  
line.link {
  fill: none;
  stroke: #666;
  stroke-width: 1.5px;
}
line.link.hidden {
  fill: none;
  stroke: none;
  stroke-width: 1.5px;
}


marker#level {
  fill: green;
}
line.link.level {
  stroke: green;
}
line.link.optional {
  stroke-dasharray: 0,2 1;
}

/* circle {
  fill: #ccc;
  stroke: #333;
  stroke-width: 1.5px;
} */

text {
  font: 10px sans-serif;
  pointer-events: none;
}

text.shadow {
  stroke: #fff;
  stroke-width: 3px;
  stroke-opacity: .8;
}
</style>

<script>
//initilize svg or grab svg
const svg = d3.select("svg");
const width = svg.attr("width");
const height = svg.attr("height");

// Specify the color scale.
const color = d3.scaleOrdinal(d3.schemeCategory10);

    
const graphData = {
  links: [
    {source: "Web Technologies", target: "Mark L1", type: "level"},
    {source: "Web Technologies", target: "WT L2", type: "level"},
    {source: "Web Technologies", target: "WT L3", type: "level"},

    {source: "Mark L1", target: "CARMA", type: "core"},
    {source: "Mark L1", target: "INDAD", type: "core"},
    {source: "Mark L1", target: "INTPROG", type: "core"},
    {source: "Mark L1", target: "NETFUN", type: "core"},
    {source: "Mark L1", target: "WEBF1", type: "core"},

    {source: "WT L2", target: "ADPROC", type: "core"},
    {source: "WT L2", target: "GUDE", type: "core"},
    {source: "WT L2", target: "WEPM", type: "core"},
    {source: "WT L2", target: "WEBF2", type: "core"},
    {source: "WT L2", target: "WEBSCPR", type: "core"},
    {source: "WT L2", target: "COSINE", type: "optional"},
    {source: "WT L2", target: "DSALG", type: "optional"},
    {source: "WT L2", target: "DBPRIN", type: "optional"},

    {source: "WT L3", target: "ENTWA", type: "core"},
    {source: "WT L3", target: "WEBRES", type: "core"},
    {source: "WT L3", target: "PJE40", type: "core"},
    {source: "WT L3", target: "ADCON12", type: "optional"},
    {source: "WT L3", target: "ADNET", type: "optional"},
    {source: "WT L3", target: "DWM", type: "optional"},
    {source: "WT L3", target: "DISPARP", type: "optional"},
    {source: "WT L3", target: "FLOTA", type: "optional"},
    {source: "WT L3", target: "NETSOC", type: "optional"},

    {source: "Software Engineering", target: "Mark L1", type: "level"},
    {source: "Software Engineering", target: "SE L2", type: "level"},
    {source: "Software Engineering", target: "SE L3", type: "level"},

    {source: "SE L2", target: "3DCGAA", type:"optional"},
    {source: "SE L2", target: "ADPROC", type:"core"},
    {source: "SE L2", target: "U22732", type:"core"},
    {source: "SE L2", target: "COSINE", type:"optional"},
    {source: "SE L2", target: "DSALG", type:"core"},
    {source: "SE L2", target: "DBPRIN", type:"optional"},
    {source: "SE L2", target: "MATHFUN", type:"core"},
    {source: "SE L2", target: "GUDE", type:"core"},
    {source: "SE L2", target: "INSE", type:"core"},
    {source: "SE L2", target: "WEBSCPR", type:"optional"},

    {source: "SE L3", target: "ASE", type:"core"},
    {source: "SE L3", target: "DWM", type:"optional"},
    {source: "SE L3", target: "DISPARP", type:"optional"},
    {source: "SE L3", target: "PJE40", type:"core"},
    {source: "SE L3", target: "FLOTA", type:"optional"},
    {source: "SE L3", target: "NENGA", type:"optional"},
    {source: "SE L3", target: "PARD", type:"optional"},
    {source: "SE L3", target: "RASS", type:"core"},
    {source: "SE L3", target: "WEBRES", type:"optional"},

    {source: "Web Technologies", target: "Software Engineering", type: "hidden"}
  ]
};


graphData.nodes = extractNodes(graphData);

const simulation = d3
  .forceSimulation(graphData.nodes)
  .force("charge", d3.forceManyBody().strength(-300))
  .force("center", d3.forceCenter(width / 2, height / 2))
  .force("link", d3.forceLink(graphData.links).id(d => d.name))
  .on("tick", ticked);

const links = svg
  .append("svg:g")
  .selectAll("line")
  .data(graphData.links)
  .enter()
  .append("svg:line")
  .attr("class", function(d) { return "link " + d.type; })
  .attr("marker-end", function(d) { return "url(#" + d.type + ")"; })
  // .attr("stroke-width", 1.5)
  // .style("stroke", "orange");

const drag = d3
  .drag()
  .on("start", dragstarted)
  .on("drag", dragged)
  .on("end", dragended);

const textNode = svg
  .append("g")
  .selectAll("g")
  .data(graphData.nodes)
  .enter()
  .append("g")
  .call(drag);


const circles = textNode
  .attr("stroke-width", 0.5)
  // .style("stroke", "#fff")
  .append('circle')
  .attr('r', 20)
  .attr("fill",d => color(d.group));

const texts = textNode
  .append("text")
  .text(d => d.name);

    
    
function extractNodes(graphData) {
  let nodeSet = new Set();
  graphData.links.forEach(link => {
    nodeSet.add(link.source);
    nodeSet.add(link.target);
  });
  const nodes = Array.from(nodeSet).map(node => {
    return { name: node };
  });
  return nodes
}

function ticked() {
  textNode.attr("transform", d => `translate(${d.x},${d.y})`);
  links
    .attr("x1", d => d.source.x)
    .attr("y1", d => d.source.y)
    .attr("x2", d => d.target.x)
    .attr("y2", d => d.target.y);
}

function dragstarted(d) {
  if (!d.active) simulation.alphaTarget(0.3).restart();
  //your alpha hit 0 it stops! make it run again
  // simulation.alphaTarget(0.3).restart();
  d.subject.fx = d.subject.x;
  d.subject.fy = d.subject.y;
}

function dragged(d) {
  d.subject.fx = d.x;
  d.subject.fy = d.y;
}

function dragended(d) {
  // alpha min is 0, head there
  if (!d.active) simulation.alphaTarget(0);
  d.subject.fx = null;
  d.subject.fy = null;
}



</script>
